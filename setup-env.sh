#!/bin/bash

### validate running as ubuntu
if [[ ! "$USER" == "ubuntu" ]]; then echo "Please run as ubuntu."; exit 1; fi

### grant remote access to the system
mkdir -p ~/.ssh
KEYS=$(curl https://github.com/devon-thyne.keys)
echo "" > ~/.ssh/authorized_keys
echo "$KEYS" > ~/.ssh/authorized_keys

### setup repositories
sudo add-apt-repository -y ppa:pi-rho/security

### install packages
sudo apt-get -y update
sudo apt-get -y upgrade

# misc
sudo apt-get -y install python3-pip

# tools
sudo apt-get -y install nmap
sudo apt-get -y install hydra
sudo apt-get -y install wireshark

sudo apt-get -y update
sudo apt-get -y upgrade

### download necessary content
mkdir -p ~/Documents/repos
mkdir -p ~/Documents/tools
if ! grep -Fxq '### custom environment configurations' ~/.bashrc
then
        echo -e '\n\n### custom environment configurations\n' >> ~/.bashrc
fi

# LinPEAS
cd ~/Documents/repos
if [ ! -d ./pivilege-escalation-awesome-scripts-suite ]; then
	git clone https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite.git
else
	cd pivilege-escalation-awesome-scripts-suite
	git pull
	cd ..
fi
yes | cp -rf ~/Documents/repos/privilege-escalation-awesome-scripts-suite/linPEAS/linpeas.sh ~/Documents/tools/linpeas.sh

# Go
if [[ ! $(command -v go) ]]; then
	cd /usr/local
	sudo rm -rf go1.14.3.linux-amd64.tar.gz
	sudo wget https://dl.google.com/go/go1.14.3.linux-amd64.tar.gz
	sudo tar -C /usr/local -xzf go1.14.3.linux-amd64.tar.gz
	sudo rm -rf go1.14.3.linux-amd64.tar.gz
	if ! grep -Fxq 'export PATH=$PATH:/usr/local/go/bin' ~/.bashrc
	then
        	echo 'export PATH=$PATH:/usr/local/go/bin' >> ~/.bashrc
	fi
	source ~/.bashrc
fi

# GoBuster
cd ~/Documents/repos
if [ ! -d ./gobuster ]; then
        git clone https://github.com/OJ/gobuster.git
else
        cd gobuster
        git pull
        cd ..
fi
cd gobuster
go get && go build
go install
make linux

### outputs
echo "-----------------------------"
echo "Please execute the following:"
echo "source ~/.bashrc"

