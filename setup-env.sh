#!/bin/bash

### validate running as ubuntu
if [[ ! "$USER" == "ubuntu" ]]; then echo "Please run as ubuntu."; exit 1; fi

### grant remote access to the system
mkdir -p ~/.ssh
KEYS=$(curl https://github.com/devon-thyne.keys)
echo "" > /home/ubuntu/.ssh/authorized_keys
echo "$KEYS" > /home/ubuntu/.ssh/authorized_keys


##### setup software
sudo apt-get -y update
sudo apt-get -y upgrade

### install pre-repos
sudo apt-get -y install software-properties-common

### setup repositories
sudo add-apt-repository -y universe
sudo add-apt-repository -y ppa:pi-rho/security
sudo add-apt-repository -y ppa:deadsnakes/ppa

### install packages
# basics
sudo apt-get -y install vim
sudo apt-get -y install git
sudo apt-get -y install wget
sudo apt-get -y install curl
sudo apt-get -y install expect
sudo apt-get -y install unzip
sudo apt-get -y install htop
sudo apt-get -y install python3.7
sudo apt-get -y install python
sudo apt-get -y install docker.io

# misc
sudo apt-get -y install pssh
sudo apt-get -y install guake

# pentest-tools
sudo apt-get -y install nmap
sudo apt-get -y install hydra
sudo apt-get -y install wireshark
sudo apt-get -y install gobuster
sudo apt-get -y install john

sudo apt-get -y update
sudo apt-get -y upgrade


### download necessary content
mkdir -p /home/ubuntu/Documents/repos
mkdir -p /home/ubuntu/Documents/tools
if ! grep -Fxq '### custom environment configurations' ~/.bashrc
then
    echo -e '\n\n### custom environment configurations\n' >> ~/.bashrc
fi

# LinPEAS
cd /home/ubuntu/Documents/repos
if [[ ! -d /home/ubuntu/Documents/repos/privilege-escalation-awesome-scripts-suite ]]; then
    git clone https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite.git
else
    cd /home/ubuntu/Documents/repos/pivilege-escalation-awesome-scripts-suite
    git pull
fi
yes | cp -rf /home/ubuntu/Documents/repos/privilege-escalation-awesome-scripts-suite/linPEAS/linpeas.sh /home/ubuntu/Documents/tools/linpeas.sh

# SecLists
cd /home/ubuntu/Documents/repos
if [[ ! -d /home/ubuntu/Documents/repos/SecLists ]]; then
    git clone https://github.com/danielmiessler/SecLists.git
else
    cd /home/ubuntu/Documents/repos/SecLists
    git pull
fi

# Kali Linus Tools
cd /home/ubuntu/Documents/repos
if [[ ! -d /home/ubuntu/Documents/repos/katoolin ]]; then
    git clone https://github.com/LionSec/katoolin.git
else
    cd /home/ubuntu/Documents/repos/katoolin
    git pull
fi
yes | sudo cp -rf /home/ubuntu/Documents/repos/katoolin/katoolin.py /usr/bin/katoolin
sudo chmod +x /usr/bin/katoolin

# poor-mans-pentest (John Hammond)
cd /home/ubuntu/Documents/repos
if [[ ! -d /home/ubuntu/Documents/repos/poor-mans-pentest ]]; then
    git clone https://github.com/JohnHammond/poor-mans-pentest.git
else
    cd /home/ubuntu/Documents/repos/poor-mans-pentest
    git pull
fi


### start services
sudo systemctl start docker
sudo systemctl enable docker

